---
title: "MatchupsProjections"
author: "Giuliano Sposito"
date: "2025-09-08"
output: html_document
---

```{r setup}
knitr::opts_knit$set(root.dir = normalizePath(rprojroot::find_rstudio_root_file())) 
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## Setup

```{r result="asis"}
library(tibble)
library(htmltools)

# --- função que desenha 1 confronto (2 linhas do tibble) ---
matchup_card <- function(df, id = "m1") {
  stopifnot(nrow(df) == 2)

  pct_txt <- function(x) paste0(round(x * 100), "%")

  team_card <- function(row, side = c("left","right")) {
    side <- match.arg(side)
    tags$div(class = paste("team", side),
      tags$div(class = "row1",
        tags$img(src = row$image_url, class = "avatar", alt = row$team),
        tags$div(class = "score", sprintf("%.2f", row$score_current))
      ),
      tags$div(class = "handle", row$handle),
      tags$div(class = "team-name", row$team),
      tags$div(class = "proj",
        tags$span("Proj."),
        tags$span(class = "num", sprintf(" %.2f", row$projection))
      ),
      tags$div(class = "barwrap",
        tags$div(class = "bar",
          tags$div(class = "fill",
                   style = paste0("width:", round(row$win_prob*100), "%;"))
        ),
        tags$div(class = "under",
          tags$span(class = "record", row$record),
          tags$span(class = "winprob", pct_txt(row$win_prob))
        )
      )
    )
  }

  tags$div(id = id, class = "wrap",
    tags$div(class = "card",
      team_card(df[1,], side = "left"),
      tags$div(class = "vs", "VS"),
      team_card(df[2,], side = "right")
    )
  )
}

# --- CSS (como string para ser injetado em um <style>) ---
matchup_css <- "
:root {
  --bg: #0f1420; --card:#1c2433; --text:#e7edf7; --muted:#9fb0c9;
  --pink:#ff7ac3; --blue:#58c4ff; --bar:#2a3447;
}
.matchup-scope { background: var(--bg); padding: 0; }
.wrap { max-width: 460px; margin: 24px auto; padding: 12px; }
.card {
  background: var(--card); border-radius: 16px; padding: 14px;
  display: flex; align-items: stretch; gap: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,.25); color: var(--text);
  font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Inter, Arial, sans-serif;
}
.team {
  flex: 1 1 0; background: rgba(255,255,255,.02);
  border-radius: 12px; padding: 12px;
  display: flex; flex-direction: column; gap: 6px;
}
.row1 { display:flex; align-items:center; gap:10px; }
.avatar {
  width: 56px; height: 56px; border-radius: 50%; object-fit: cover;
  border: 2px solid rgba(255,255,255,.12);
}
.score { margin-left:auto; font-weight:800; font-size:22px; }
.handle { font-size:12px; color:var(--muted); }
.team-name { font-weight:600; line-height:1.2; }
.proj { display:flex; gap:6px; align-items:baseline; color:var(--muted); font-size:12px; }
.proj .num { color:var(--text); font-weight:600; }
.barwrap { display:flex; flex-direction:column; gap:6px; }
.bar { height:6px; background:var(--bar); border-radius:999px; overflow:hidden; }
.fill { height:100%; border-radius:999px; }
.team.left  .fill { background:linear-gradient(90deg, var(--pink), var(--blue)); }
.team.right .fill { background:linear-gradient(90deg, var(--blue), var(--pink)); }
.under { display:flex; justify-content:space-between; font-size:12px; color:var(--muted); }
.under .winprob { color:var(--text); font-weight:600; }
.vs { display:grid; place-items:center; width:44px; font-weight:800; color:var(--muted); }
@media (max-width: 460px) { .card { gap: 8px; } .vs { width: 36px; } }
"

# envolve em um escopo opcional para não interferir no resto do documento
cat('<div class="matchup-scope">')
cat("<style>", matchup_css, "</style>")

# seus dados (exemplo)
matchup <- tibble(
  handle        = c("@GiulDizzyBR", "@ltogniolli"),
  team          = c("Monte Alegre", "Paulinia Rockets"),
  score_current = c(8.00, 18.00),
  projection    = c(134.05, 138.84),
  win_prob      = c(0.47, 0.53),  # 0–1
  record        = c("0-0", "0-0"),
  image_url     = c(
    "https://placehold.co/80x80/png?text=A",
    "https://placehold.co/80x80/png?text=B"
  )
)

# gera só o pedaço HTML e escreve como 'asis'
ui <- matchup_card(matchup, id = "match1")
cat(as.character(ui))

# fecha o escopo visual (opcional)
cat('</div>')

```

